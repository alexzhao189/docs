# ç›‘å¬ç®¡ç†
---

## ğŸš€ æ¶ˆæ¯ç›‘å¬

### æ·»åŠ æ¶ˆæ¯ç›‘å¬

> é€‚ç”¨äºèŠå¤©ï¼ˆä¸å¥½å‹æˆ–è€…åœ¨ç¾¤èŠä¸­)æ—¶ç›‘å¬å¥½å‹å‘æ¥çš„æ¶ˆæ¯,éœ€è¦æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°

å¯ä»¥é€šè¿‡[WeChatClinetå¯¹è±¡](../api/WeChatAuto.Components.WeChatClient.html)è°ƒç”¨```AddMessageListener```æ–¹æ³•,å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡[WeChatMainWindow](../api/WeChatAuto.Components.WeChatMainWindow.html)ç±»æ¥è°ƒç”¨æ­¤æ–¹æ³•

æ–¹æ³•å®šä¹‰:

```
public async Task AddMessageListener(string nickName, Action<MessageContext> callBack)
```

å…¶ä¸­ï¼š
  - nickName: å¥½å‹æ˜µç§°
  - callBack: å›è°ƒå‡½æ•°,ç”±ç”¨æˆ·æä¾›,å‚æ•°è¯·å‚è€ƒ[MessageContextç±»](../api/WeChatAuto.Models.MessageContext.html)

### ç§»é™¤æ¶ˆæ¯ç›‘å¬

> æ·»åŠ æ¶ˆæ¯ç›‘å¬ä¼šå¯åŠ¨ä¸€ä¸ª```System.Threading.Timer```æ¥ç›‘å¬æ¶ˆæ¯ï¼Œæ‰€ä»¥å¦‚æœä¸éœ€è¦è¿™ä¸ªç›‘å¬çš„æ—¶å€™ï¼Œè¯·ç§»é™¤ç›‘å¬

æ–¹æ³•å®šä¹‰:

```
 public void StopMessageListener(string nickName)
```

å…¶ä¸­:

  - nickName: å¥½å‹æ˜µç§°

## ğŸš€ æ–°å¥½å‹ç”³è¯·ç›‘å¬

å¦‚æœæ·»åŠ äº†æ–°å¥½å‹ç”³è¯·ç›‘å¬ï¼Œå½“æœ‰æ–°å¥½å‹æ·»åŠ ä½ çš„å¾®ä¿¡æ—¶ï¼Œä¼šè‡ªåŠ¨ç›‘å¬åˆ°å¥½å‹ç”³è¯·ï¼Œå¹¶ä¸”æ‰§è¡Œä½ å®šä¹‰çš„é€»è¾‘

> å¯ä»¥é€šè¿‡[WeChatClinetå¯¹è±¡](../api/WeChatAuto.Components.WeChatClient.html)è°ƒç”¨æ–¹æ³•,å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡[WeChatMainWindow](../api/WeChatAuto.Components.WeChatMainWindow.html)ç±»æ¥è°ƒç”¨ã€‚

### è‡ªåŠ¨é€šè¿‡æ–°å¥½å‹ç”³è¯·

ç”¨æˆ·åªéœ€æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“æ£€æµ‹åˆ°æœ‰æ–°å¥½å‹ç”³è¯·æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€šè¿‡ç”³è¯·ï¼Œå¹¶åœ¨é€šè¿‡åè°ƒç”¨ç”¨æˆ·çš„å›è°ƒå‡½æ•°ã€‚

> å¯é€šè¿‡[WeChatClientå¯¹è±¡](../api/WeChatAuto.Components.WeChatClient.html)è°ƒç”¨```AddFriendRequestAutoAcceptListener```æ–¹æ³•ã€‚

æ–¹æ³•å®šä¹‰:

```
public void AddFriendRequestAutoAcceptListener(Action<List<string>> callBack, string keyWord = null, string suffix = null, string label = null)
```

å‚æ•°è¯´æ˜ï¼š
  - callBackï¼šè‡ªå®šä¹‰å›è°ƒå‡½æ•°ï¼Œå½“æœ‰æ–°å¥½å‹æ·»åŠ æˆåŠŸæ—¶è¢«è°ƒç”¨
  - keyWordï¼šå¯é€‰, è®¾å®šå…³é”®è¯ï¼›ä»…å½“å¥½å‹ç”³è¯·å†…å®¹åŒ…å«æ­¤å…³é”®è¯æ—¶æ‰è‡ªåŠ¨é€šè¿‡ã€‚è‹¥ä¸º```null```ï¼Œåˆ™æ‰€æœ‰å¥½å‹ç”³è¯·å‡ä¼šè¢«è‡ªåŠ¨é€šè¿‡
  - suffixï¼šå¯é€‰ï¼Œè‡ªåŠ¨é€šè¿‡æ—¶åœ¨æ–°å¥½å‹æ˜µç§°åæ·»åŠ çš„åç¼€ï¼Œä¾¿äºç®¡ç†åˆ†ç±»
  - labelï¼šå¯é€‰ï¼Œè‡ªåŠ¨é€šè¿‡æ—¶ä¸ºæ–°å¥½å‹æ‰“ä¸Šçš„å¾®ä¿¡æ ‡ç­¾ï¼Œæ–¹ä¾¿åˆ†ç±»ç®¡ç†

### è‡ªåŠ¨é€šè¿‡æ–°å¥½å‹ç”³è¯·-ç›‘æ§å¥½å‹æ¶ˆæ¯-ä¹Ÿå¯ä»¥å‘é€é¦–æ¬¡èŠå¤©æ¶ˆæ¯

ç”¨æˆ·åªéœ€æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“è‡ªåŠ¨é€šè¿‡å¥½å‹ç”³è¯·åï¼Œå¦‚æœå¥½å‹æœ‰æ¶ˆæ¯å‘é€è¿‡æ¥ï¼Œä¼šè¢«ç›‘å¬åˆ°ï¼Œå¯ä»¥é€šè¿‡```MessageContext```å¯¹è±¡è·å–å®¢æˆ·ä¿¡æ¯å¹¶å›å¤ç­‰ï¼Œå…·ä½“è¯·å‚çœ‹: [MessageContext](../api/WeChatAuto.Models.MessageContext.html)ã€‚

å¯é€‰çš„ï¼Œä¹Ÿå¯ä»¥åœ¨è‡ªåŠ¨é€šè¿‡å¥½å‹åï¼Œç”±æˆ‘é¦–å…ˆå‘èµ·èŠå¤©ï¼ˆè®©æˆ‘é¦–å…ˆç»™å®¢æˆ·å‘é€æ–‡æœ¬ã€è¡¨æƒ…ã€å›¾ç‰‡ã€æ–‡ä»¶ç­‰ï¼‰ï¼Œå¯ä»¥é€šè¿‡```Sender```å¯¹è±¡å‘é€é¦–æ¬¡æ¶ˆæ¯ï¼Œå…·ä½“è¯·å‚è€ƒ: [Sender](../api/WeChatAuto.Components.Sender.html)ã€‚

> å¯é€šè¿‡[WeChatClientå¯¹è±¡](../api/WeChatAuto.Components.WeChatClient.html)è°ƒç”¨```AddFriendRequestAutoAcceptAndOpenChatListener```æ–¹æ³•ã€‚

æ–¹æ³•å®šä¹‰:

```
    public void AddFriendRequestAutoAcceptAndOpenChatListener(Action<MessageContext> callBack, Action<Sender> firstMessageAction = null, string keyWord = null, string suffix = null, string label = null
```

å‚æ•°è¯´æ˜ï¼š
  - callBackï¼šè‡ªå®šä¹‰å›è°ƒå‡½æ•°ï¼Œå½“æœ‰æ–°å¥½å‹æ·»åŠ æˆåŠŸæ—¶è¢«è°ƒç”¨,å½“è‡ªåŠ¨é€šè¿‡å¥½å‹ç”³è¯·åï¼Œå¦‚æœå¥½å‹æœ‰æ¶ˆæ¯å‘é€è¿‡æ¥ï¼Œåˆ™æ‰§è¡Œæ­¤å›è°ƒæ–¹æ³•,ç³»ç»Ÿæ³¨å…¥ä¸€ä¸ª ```MessageContext```å¯¹è±¡æ”¯æŒè·å–æ‰€æœ‰èŠå¤©ä¿¡æ¯çš„ä¸Šä¸‹æ–‡æ”¯æŒï¼Œå…·ä½“è¯·å‚è€ƒ: [MessageContextç±»](../api/WeChatAuto.Models.MessageContext.html)
  - firstMessageAction: å¯é€‰, å½“è‡ªåŠ¨é€šè¿‡å¥½å‹ç”³è¯·åï¼Œç”±æˆ‘é¦–æ¬¡ç»™å¥½å‹å‘é€æ¶ˆæ¯,æ­¤Actionç”±ç³»ç»Ÿè‡ªåŠ¨æ³¨å…¥ä¸€ä¸ª ```Sender```å¯¹è±¡å¯ä»¥ç”±â€œæˆ‘â€æ¥å‘èµ·æ‰“æ‹›å‘¼ç­‰æ¶ˆæ¯
  - keyWordï¼šå¯é€‰, è®¾å®šå…³é”®è¯ï¼›ä»…å½“å¥½å‹ç”³è¯·å†…å®¹åŒ…å«æ­¤å…³é”®è¯æ—¶æ‰è‡ªåŠ¨é€šè¿‡ã€‚è‹¥ä¸º```null```ï¼Œåˆ™æ‰€æœ‰å¥½å‹ç”³è¯·å‡ä¼šè¢«è‡ªåŠ¨é€šè¿‡
  - suffixï¼šå¯é€‰ï¼Œè‡ªåŠ¨é€šè¿‡æ—¶åœ¨æ–°å¥½å‹æ˜µç§°åæ·»åŠ çš„åç¼€ï¼Œä¾¿äºç®¡ç†åˆ†ç±»
  - labelï¼šå¯é€‰ï¼Œè‡ªåŠ¨é€šè¿‡æ—¶ä¸ºæ–°å¥½å‹æ‰“ä¸Šçš„å¾®ä¿¡æ ‡ç­¾ï¼Œæ–¹ä¾¿åˆ†ç±»ç®¡ç†

### ç§»é™¤å¥½å‹ç”³è¯·ç›‘å¬

æ–¹æ³•å®šä¹‰:
```
StopNewUserListener()
```

## ğŸš€ æ·»åŠ æœ‹å‹åœˆç›‘å¬
> å¼€å¯æœ‹å‹åœˆç›‘å¬åï¼Œå¯ä»¥è‡ªåŠ¨è·å–åˆ°å¥½å‹åœ¨æœ‹å‹åœˆå‘å¸ƒçš„åŠ¨æ€ï¼Œé€‚åˆå®ç°è‡ªåŠ¨ç‚¹èµã€è‡ªåŠ¨è¯„è®ºç­‰åŠŸèƒ½ã€‚

å¯ä»¥é€šè¿‡[WeChatClinetå¯¹è±¡](../api/WeChatAuto.Components.WeChatClient.html)è°ƒç”¨æ–¹æ³•,å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡[WeChatMainWindow](../api/WeChatAuto.Components.WeChatMainWindow.html)ç±»æ¥è°ƒç”¨ã€‚


æ–¹æ³•ç­¾åï¼š

```
public void AddMomentsListener(OneOf<string, List<string>> nickNameOrNickNames, bool autoLike = true, Action<MomentsContext, IServiceProvider> action = null)
```

å‚æ•°è¯´æ˜ï¼š
- nickNameOrNickNamesï¼šå•ä¸ªå¥½å‹æ˜µç§°æˆ–æ˜µç§°åˆ—è¡¨ï¼Œè¡¨ç¤ºéœ€è¦ç›‘å¬å“ªäº›å¥½å‹çš„æœ‹å‹åœˆåŠ¨æ€ã€‚
- autoLikeï¼šæ˜¯å¦è‡ªåŠ¨ç‚¹èµï¼Œé»˜è®¤ä¸º trueã€‚å¦‚éœ€å…³é—­è‡ªåŠ¨ç‚¹èµå¯è®¾ç½®ä¸º falseã€‚
- actionï¼šå½“ç›‘å¬åˆ°æœ‹å‹åœˆæ–°åŠ¨æ€æ—¶è‡ªåŠ¨è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚å›è°ƒå‚æ•°åŒ…æ‹¬ï¼š
  - [MomentsContext](../api/WeChatAuto.Utils.MomentsContext.html)ï¼šåŒ…å«ç‚¹èµã€è¯„è®ºç­‰æ“ä½œæ–¹æ³•ã€‚
  - IServiceProviderï¼šä¾èµ–æ³¨å…¥æœåŠ¡æä¾›å™¨ï¼Œå¯ç”¨äºè·å–è‡ªå®šä¹‰ Serviceï¼Œæ–¹ä¾¿æ‰©å±•è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚

### MomentsContextè¯¦è§£

> MomentsContextä¸ºå¤„ç†æœ‹å‹åœˆåŠ¨æ€æä¾›çš„ä¸Šä¸‹æ–‡å¯¹è±¡,æ–¹ä¾¿ä¸LLMé›†æˆ

å±æ€§ä¸æ–¹æ³•å¦‚ä¸‹ï¼š

- è·å–å†å²å›å¤åˆ—è¡¨

æ–¹æ³•ç­¾å:

```
public List<ReplyItem> GetHistoryReplyItems()
```

è¿”å›```List<ReplyItem>```åˆ—è¡¨ï¼Œå…·ä½“```ReplyItem```ç±»è¯·å‚è€ƒï¼š[ReplyItem](../api/WeAutoCommon.Models.ReplyItem.html)

- è·å–æœ‹å‹åœˆåŠ¨æ€å†…å®¹é¡¹

æ–¹æ³•é‰´åï¼š

```
public MomentItem GetMomentItem() 
```

è¿”å›```MomentItem```å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡æ­¤å¯¹è±¡è·å–å‘é€æœ‹å‹åœˆåŠ¨æ€çš„å¥½å‹æ˜µç§°ã€å†…å®¹ã€æ—¶é—´ã€è¯„è®ºåˆ—è¡¨ã€æˆ‘æ˜¯å¦ç‚¹èµç­‰ä¿¡æ¯,å…·ä½“è¯·å‚è€ƒ:[MomentItem](../api/WxAutoCommon.Models.MomentItem.html)

- è·å–æœ‹å‹åœˆåŠ¨æ€å†…å®¹

æ–¹æ³•é‰´å:
```
public string GetMomentContent()
```

> æ­¤å†…å®¹å¯ä»¥åšä¸ºå¤§æ¨¡å‹æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

- è·å–æœ‹å‹åœˆåŠ¨æ€åˆ—è¡¨é¡¹å”¯ä¸€æ ‡è¯†
æ–¹æ³•å®šä¹‰ï¼š
```
public string GetMomentKey()
```

è¿”å›æœ‹å‹åœˆåŠ¨æ€åˆ—è¡¨çš„å”¯ä¸€æ ‡è¯†,æ­¤æ ‡è¯†å¯ä»¥åšä¸ºå¤§æ¨¡å‹æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯,å¦‚ï¼šæœ‹å‹åœˆåŠ¨æ€è®°å½•å”¯ä¸€æ ‡è¯†ã€‚

- æ˜¯å¦æˆ‘æ˜¯æœ€åä¸€ä¸ªå›å¤çš„äºº
æ–¹æ³•å®šä¹‰ï¼š
```
public bool IsMyEndReply()
```

ç¡®è®¤æˆ‘æ˜¯å¦æ˜¯æœ€åçš„å›å¤äººï¼Œä¾›å¤§æ¨¡å‹è‡ªåŠ¨å›å¤æœ‹å‹åœˆåŠ¨æ€æ—¶å‚è€ƒ

- æ˜¯å¦æœ‹å‹åŠ¨æ€çš„å›å¤åˆ—è¡¨ä¸­åŒ…å«æˆ‘çš„å›å¤
æ–¹æ³•å®šä¹‰:
```
public bool IsIncludeMyReply()
```

å›å¤åˆ—è¡¨ä¸­æ˜¯å¦åŒ…å«æˆ‘çš„å›å¤ï¼Œä¾›å¤§æ¨¡å‹è‡ªåŠ¨å›å¤æ—¶å‚è€ƒã€‚

- æ˜¯å¦æˆ‘ç‚¹èµè¿‡æœ‹å‹åœˆåŠ¨æ€
æ–¹æ³•å®šä¹‰:
```
public bool IsMyLiked()
```

æ­¤æœ‹å‹åœˆåŠ¨æ€æ˜¯å¦æˆ‘ç‚¹èµè¿‡ï¼Œä¾›æ¨¡å‹è‡ªåŠ¨å›å¤æ—¶å‚è€ƒ

- æ‰§è¡Œå›å¤æœ‹å‹åœˆåŠ¨æ€

æ–¹æ³•å®šä¹‰:
```
public void DoReply(string replyContent)
```
>ä¸ºæ­¤æ¡æœ‹å‹åœˆåŠ¨æ€è¿›è¡Œå›å¤

å…¶ä¸­:
  - replyContent: å›å¤å†…å®¹

- æ‰§è¡Œæœ‹å‹åœˆåŠ¨æ€ç‚¹èµ

æ–¹æ³•å®šä¹‰ï¼š

```
public void DoLike()
```

> ä¸ºæ­¤æ¡æœ‹å‹åœˆåŠ¨æ€è¿›è¡Œç‚¹èµï¼Œå¦‚æœå·²ç»ç‚¹èµï¼Œåˆ™ä¸ä½œæ“ä½œ.